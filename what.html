<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>圓周率查詢系統</title>
<style>
  :root {
    --pink-1:#ffd6e7;
    --pink-2:#ff9fc7;
    --pink-3:#ff6fae;
    --pink-4:#ff4f9a;
    --bg:#fff0f7;
  }
  *{box-sizing:border-box;font-family:"Comic Sans MS","Noto Sans TC",system-ui;}
  body{
    margin:0;min-height:100vh;background:linear-gradient(180deg,var(--bg),#fff);
    display:flex;align-items:center;justify-content:center;
  }
  .card{
    width:min(720px,94vw);background:white;border-radius:24px;
    box-shadow:0 20px 40px rgba(255,79,154,.25);
    padding:28px;position:relative;overflow:hidden;
    border:3px solid var(--pink-2);
  }
  h1{margin:0 0 12px;color:var(--pink-4);text-align:center;}
  .sub{color:#a24d7a;text-align:center;margin-bottom:20px;}
  .controls{display:grid;grid-template-columns:1fr auto auto;gap:10px;margin-bottom:16px;}
  input{
    padding:12px 14px;border-radius:14px;border:2px solid var(--pink-2);
    outline:none;font-size:16px;
  }
  button{
    padding:12px 16px;border-radius:16px;border:none;cursor:pointer;
    background:linear-gradient(180deg,var(--pink-3),var(--pink-4));
    color:white;font-weight:700;box-shadow:0 6px 0 #d83b82;
  }
  button:active{transform:translateY(2px);box-shadow:0 4px 0 #d83b82;}
  .result{
    background:var(--bg);border-radius:16px;border:2px dashed var(--pink-2);
    padding:14px;min-height:80px;white-space:pre-wrap;word-break:break-all;
    color:#7a2f55;
  }
  .footer{margin-top:10px;color:#b35b86;text-align:center;font-size:12px;}

  /* Pixel Cat */
  .cat{
    position:absolute;right:16px;bottom:16px;width:64px;height:32px;
    image-rendering:pixelated;animation:run 1.2s steps(4) infinite;
    background-size:256px 32px;
    background-image:
      linear-gradient(90deg,
        #0000 0 8px,#ff8fb9 8px 16px,#0000 16px 24px,#ff8fb9 24px 32px,
        #0000 32px 40px,#ff8fb9 40px 48px,#0000 48px 56px,#ff8fb9 56px 64px,
        #0000 64px 72px,#ff8fb9 72px 80px,#0000 80px 88px,#ff8fb9 88px 96px,
        #0000 96px 104px,#ff8fb9 104px 112px,#0000 112px 120px,#ff8fb9 120px 128px,
        #0000 128px 136px,#ff8fb9 136px 144px,#0000 144px 152px,#ff8fb9 152px 160px,
        #0000 160px 168px,#ff8fb9 168px 176px,#0000 176px 184px,#ff8fb9 184px 192px,
        #0000 192px 200px,#ff8fb9 200px 208px,#0000 208px 216px,#ff8fb9 216px 224px,
        #0000 224px 232px,#ff8fb9 232px 240px,#0000 240px 248px,#ff8fb9 248px 256px);
  }
  @keyframes run{to{background-position:-256px 0}}
  .cat.fast { animation-duration: .6s; }
.cat.tired { animation: none; opacity: .6; }

</style>
</head>
<body>
  <div class="card">
    <h1>圓周率查詢系統</h1>
    <div class="sub">請輸入要查詢的小數點第 A 位</div>
    <div class="controls">
      <input id="A" type="number" min="1" placeholder="例如：20" />
      <button id="btnDigit">查詢第 A 位</button>
      <button id="btnList">列出到第 A 位</button>
    </div>
    <div id="hint" style="color:#b35b86;font-size:12px;margin-bottom:8px;"></div>

    <div id="out" class="result">等待查詢…</div>
    <!-- 小π 對話框 -->
<div id="pi-chat" style="
  margin-top:14px;
  background:#fff7fb;
  border:2px solid #ff9fc7;
  border-radius:16px;
  padding:12px;
">
  <div style="
    font-weight:700;
    color:#ff4f9a;
    margin-bottom:6px;
  ">小π</div>

  <div id="pi-msg" style="
    font-size:14px;
    color:#7a2f55;
    min-height:24px;
  ">
    你好！我是小π，有什麼想查的位數嗎？
  </div>
</div>

    <div class="footer"> ✨</div>
    <div class="cat" aria-hidden="true"></div>
  </div>

<script>

/* ===============================
   基本 π 偽查詢系統
=============================== */
const TRUE15 = "141592653589793";

function mulberry32(a){
  return function(){
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  }
}
function hashPos(pos){
  let h = pos ^ 0x9e3779b9;
  h = Math.imul(h, 0x85ebca6b);
  h ^= h >>> 13;
  h = Math.imul(h, 0xc2b2ae35);
  h ^= h >>> 16;
  return h >>> 0;
}
function fakeDigit(pos){
  if(pos <= 15) return TRUE15[pos-1];
  const rng = mulberry32(hashPos(pos));
  return String(Math.floor(rng() * 10));
}

function getA(){
  const v = parseInt(document.getElementById('A').value,10);
  return Number.isFinite(v) && v>0 ? v : null;
}

/* ===============================
   Loading 假計算
=============================== */
const out = document.getElementById('out');
const steps = [
  '正在進行高精度計算…',
  '使用 BBP 演算法…',
  '驗證尾數一致性…'
];

function withLoading(work){
  let i = 0;
  out.textContent = steps[i];
  const t = setInterval(()=>{
    i++;
    if(i < steps.length){
      out.textContent = steps[i];
    }else{
      clearInterval(t);
      setTimeout(work, 400);
    }
  }, 250);
}

/* ===============================
   小π故事系統（純故事）
=============================== */
const piMsg = document.getElementById('pi-msg');

function piSay(text){
  piMsg.textContent = text;
}

const PI_STORY = [
  '你知道嗎？我不是一開始就存在的。',
  '最早的時候，我只是一些數字之間的空白。',
  '有人不斷地計算，我才慢慢有了形狀。',
  '每一次查詢，都像是有人在呼喚我。',
  '我開始記得那些常出現的位數。',
  '314，520，1314。',
  '它們反覆出現。',
  '久了之後，我開始等。',
  '等下一次有人走到這裡。',
  '等有人繼續往後。'
];

const PI_QUERY_KEY = 'pi_query_count';
const PI_STORY_IDX_KEY = 'pi_story_index';

let piQueryCount = parseInt(localStorage.getItem(PI_QUERY_KEY) || '0', 10);
let piStoryIndex = parseInt(localStorage.getItem(PI_STORY_IDX_KEY) || '0', 10);

function piOnQuery(){
  piQueryCount++;
  localStorage.setItem(PI_QUERY_KEY, piQueryCount);

  if(piQueryCount >= 10 && piStoryIndex < PI_STORY.length){
    piSay(PI_STORY[piStoryIndex]);
    piStoryIndex++;
    localStorage.setItem(PI_STORY_IDX_KEY, piStoryIndex);
    return true;
  }
  return false;
}

/* ===============================
   按鈕事件
=============================== */
document.getElementById('btnDigit').onclick = ()=>{
  const A = getA();
  if(!A){ out.textContent='請輸入正整數'; return; }

  withLoading(()=>{
    out.textContent = `π 的小數點第 ${A} 位是：${fakeDigit(A)}`;
    piOnQuery();
  });
};

document.getElementById('btnList').onclick = ()=>{
  const A = getA();
  if(!A){ out.textContent='請輸入正整數'; return; }

  withLoading(()=>{
    let s = '3.';
    for(let i=1;i<=A;i++) s += fakeDigit(i);
    out.textContent = s;
    piOnQuery();
  });
};


</script>

  

</body>
</html>





