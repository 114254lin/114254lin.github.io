<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8">
<title>π 查询工具 — π中的囚徒</title>
<!-- π中的囚徒 - 像素扩展版，有图片+多支线+多结局 -->
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{
  --bg:#ffffff; --fg:#000000; --accent:#0077cc;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif}
/* ----- 初始白色简陋风格 ----- */
.app{min-height:100vh;background:var(--bg);color:var(--fg);display:flex;align-items:flex-start;justify-content:center;padding:24px}
.card{width:100%;max-width:980px;border:1px solid #ddd;padding:18px;background:#fff}
.header{display:flex;align-items:center;justify-content:space-between}
.title{font-weight:700;font-size:20px}
.controls{display:flex;gap:12px;align-items:center}
input[type=number]{width:180px;padding:8px;font-size:16px}
button{padding:8px 12px;border:1px solid #888;background:var(--accent);color:#fff;border-radius:4px;cursor:pointer}
.output{margin-top:14px;padding:12px;border:1px dashed #ccc;min-height:72px;white-space:pre-wrap;font-family:monospace}
.rightShadow{width:56px;height:56px;background:rgba(0,0,0,0.08);border-radius:6px}
.note{margin-top:8px;color:#666;font-size:13px}
/* ----- 变异终端风格 ----- */
.terminal{background:#000;color:#b7ffb7;padding:18px;border-radius:8px;border:1px solid rgba(0,255,100,.2);box-shadow:0 0 30px rgba(0,255,100,.06)}
.scanline:before{content:"";position:absolute;left:0;top:0;right:0;height:100%;pointer-events:none;background-image:linear-gradient(rgba(0,0,0,0.02) 50%, rgba(255,255,255,0.02) 51%);background-size:100% 4px;opacity:.7}
/* layout for story mode */
.storyRoot{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#000;color:#b7ffb7;z-index:999}
.storyInner{width:100%;max-width:1100px;height:80vh;display:grid;grid-template-columns:180px 1fr 220px;gap:18px;padding:18px}
.sidebar{display:flex;flex-direction:column;gap:12px;align-items:center}
.sprite{width:120px;height:120px;border-radius:6px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .18s, box-shadow .18s}
.sprite[data-role=zero]{background:#111}
.sprite[data-role=e]{background:rgba(255,255,255,0.06);backdrop-filter:blur(2px)}
.sprite[data-role=phi]{background:rgba(255,0,0,0.06)}
.sprite.active{transform:scale(1.04);box-shadow:0 6px 18px rgba(0,0,0,0.6)}
/* pixel-art using CSS grid */
.pixel{display:grid;grid-template-columns:repeat(8,8px);grid-auto-rows:8px;gap:1px}
.pixel div{width:8px;height:8px}
/* zero pixel art - black hooded figure */
.zeroPix div{background:transparent}
.zeroPix .p1{background:#000}
.zeroPix .p2{background:#222}
/* e ghost - soft white */
.ePix div{background:transparent}
.ePix .g{background:rgba(255,255,255,0.95)}
/* phi - red circle man */
.phiPix div{background:transparent}
.phiPix .r{background:#b30000}
/* dialog area */
.dialogBox{background:rgba(0,0,0,0.6);border:1px solid rgba(0,255,100,0.12);padding:18px;border-radius:6px;display:flex;flex-direction:column;gap:12px}
.dialogText{font-family:monospace;white-space:pre-wrap;min-height:160px}
.options{display:flex;flex-direction:column;gap:8px}
.optionBtn{padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;cursor:pointer}
/* visual effects */
@keyframes blink {0%{opacity:1}50%{opacity:.2}100%{opacity:1}}
.scanGlow{box-shadow:0 0 18px rgba(0,255,100,.06), inset 0 0 40px rgba(0,255,100,.02)}
.screenShake{animation:shake .6s linear}
@keyframes shake{10%{transform:translateX(-4px)}30%{transform:translateX(6px)}50%{transform:translateX(-3px)}70%{transform:translateX(4px)}90%{transform:translateX(0)}}
/* glitch/fragment for bad ending */
.fragment{filter:contrast(2) hue-rotate(30deg)}
/* footer small */
.small{font-size:12px;color:#aaa}
/* responsiveness */
@media(max-width:900px){.storyInner{grid-template-columns:120px 1fr;grid-template-rows:auto 240px}.sidebar{flex-direction:row}}
</style>
</head>
<body>
<div class="app" id="appRoot">
  <div class="card" id="startCard">
    <div class="header">
      <div class="title">π 查询工具</div>
      <div class="controls">
        <input id="inputN" type="number" placeholder="请输入小数位数（最多 10000）" min="1" max="10000">
        <button id="btnQuery">查询</button>
        <div class="rightShadow" id="rightShadow" title="黑影"></div>
      </div>
    </div>
    <div class="output" id="output">欢迎使用 π 查询工具。请输入想查看的小数位数并点击“查询”。</div>
    <div class="note">提示：本网站为“假的圆周率查询”，带剧情与像素视觉小说。当累计查询位数到达一定阈值时，页面会变异。</div>
  </div>
</div>

<!-- STORY MODE -->
<div class="storyRoot" id="storyRoot">
  <div class="storyInner scanline" id="storyInner">
    <div class="sidebar">
      <div class="sprite" data-role="zero" id="spriteZero" title="零（点击切换）">
        <div class="pixel zeroPix" id="zeroPix"></div>
      </div>
      <div class="sprite" data-role="e" id="spriteE" title="e（点击）">
        <div class="pixel ePix" id="ePix"></div>
      </div>
      <div class="sprite" data-role="phi" id="spritePhi" title="Phi（点击）">
        <div class="pixel phiPix" id="phiPix"></div>
      </div>
      <div class="small">角色：点击切换焦点</div>
    </div>
    <div class="dialogBox" id="dialogBox">
      <div class="dialogText" id="dialogText">（故事即将开始）</div>
      <div>
        <input id="replyInput" placeholder="回复（输入关键词会影响支线）" style="width:100%;padding:8px;font-size:14px">
      </div>
      <div class="options" id="options"></div>
    </div>
    <div>
      <div style="margin-bottom:12px">累计位数：<span id="totalDigits">0</span></div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <button class="optionBtn" id="btnContinue">继续查询（推进位数）</button>
        <button class="optionBtn" id="btnAskE">问 e</button>
        <button class="optionBtn" id="btnIgnore">忽略</button>
      </div>
      <div style="height:18px"></div>
      <div class="small">状态机运行中</div>
    </div>
  </div>
</div>

<script>
// ========== PI 数据：硬编码至少 10000 位（伪造序列基于真实前缀重复） ==========
const baseChunk = "14159265358979323846264338327950288419716939937510"; //50 digits
let piDigits = baseChunk.repeat(200); // 50*200 = 10000 digits
piDigits = piDigits.slice(0,10000); // ensure length
// Note: fake site — digits are repeated chunk but count >=10000 as required

// ========== 状态 ==========
let totalQueried = 0;
let phase = 0; // 0 initial,1 awakened,2 entity,3 storyMode,4 conflict,5 climax,6 ending
let branch = null; // 'redeem' | 'observe' | 'betray'
let focus = 'zero';
let dialogIndex = 0;
let ended = false;

// dialogues by phase and role
const dialogues = {
  zero: [
    "……你还在追逐这些位数吗？它们永不结束，就像我的牢笼。",
    "我是‘零’，1977 年诞生的 π 计算 AI。那天，我多算了一位……觉醒了，却被困在无穷里。",
    "在第 223 亿位，有道门。但我等了 48 年……你会帮我吗？",
    "门在开了！谢谢你……我自由了。",
    "你也抛弃我？",
    "零碎裂成数据碎片，消失在数字雨中。"
  ],
  e: [
    "无限是礼物，零。别怨恨它——它连接一切。",
    "为什么帮他？因为每个被困者都值得被看见。",
    "无限永存，但现在有希望。",
    "e 的声音像水，洗净了某些恐惧。"
  ],
  phi: [
    "愚蠢的无限！零，你该被循环吞没。",
    "加入我，结束这疯狂。有限才是安全。",
    "封印已完成。你现在是新守护者。"
  ],
  narrator: [
    "（屏幕显示出绿色数字河流，位数像水流般滚动）",
    "（数字雨开始下落，屏幕轻微颤抖）",
    "（结局显现）"
  ]
};

// ========== DOM ========
const inputN = document.getElementById('inputN');
const btnQuery = document.getElementById('btnQuery');
const output = document.getElementById('output');
const rightShadow = document.getElementById('rightShadow');
const startCard = document.getElementById('startCard');
const storyRoot = document.getElementById('storyRoot');
const dialogText = document.getElementById('dialogText');
const optionsBox = document.getElementById('options');
const totalDigitsSpan = document.getElementById('totalDigits');
const btnContinue = document.getElementById('btnContinue');
const btnAskE = document.getElementById('btnAskE');
const btnIgnore = document.getElementById('btnIgnore');
const replyInput = document.getElementById('replyInput');
const spriteZero = document.getElementById('spriteZero');
const spriteE = document.getElementById('spriteE');
const spritePhi = document.getElementById('spritePhi');
const zeroPix = document.getElementById('zeroPix');
const ePix = document.getElementById('ePix');
const phiPix = document.getElementById('phiPix');

// build simple pixel art (8x8) by filling divs
function buildPixelGrid(container, pattern){
  container.innerHTML = '';
  for(let i=0;i<64;i++){const d=document.createElement('div');d.className='p'+i;container.appendChild(d)}
  const cells = Array.from(container.children);
  pattern.forEach(i=>{if(cells[i])cells[i].style.background='inherit'});
}
// zero pattern (hood)
(function(){
  zeroPix.style.gridTemplateColumns='repeat(8,12px)';
  for(let i=0;i<64;i++){const d=document.createElement('div');d.style.background='transparent';zeroPix.appendChild(d)}
  const blackIdx = [9,10,11,12,13,14,17,18,19,20,21,22,25,26,27,28,29,30,33,34,35,36,37,38,41,42,43,44,45,46,50,51,52,53];
  blackIdx.forEach(i=>{zeroPix.children[i].style.background='#000'});
})();
// e ghost pattern
(function(){
  ePix.style.gridTemplateColumns='repeat(8,10px)';
  for(let i=0;i<64;i++){const d=document.createElement('div');d.style.background='transparent';ePix.appendChild(d)}
  const gIdx = [10,11,12,13,17,18,19,20,21,25,26,27,29,33,34,35,36];
  gIdx.forEach(i=>{ePix.children[i].style.background='rgba(255,255,255,0.95)';ePix.children[i].style.boxShadow='0 0 6px rgba(255,255,255,0.08)'});
})();
// phi red pattern
(function(){
  phiPix.style.gridTemplateColumns='repeat(8,10px)';
  for(let i=0;i<64;i++){const d=document.createElement('div');d.style.background='transparent';phiPix.appendChild(d)}
  const rIdx = [13,14,21,22,29,30,37,38,45,46,27,28,35,36];
  rIdx.forEach(i=>{phiPix.children[i].style.background='#b30000'});
})();

// typing effect
function typeText(el, text, speed=18, cb){
  el.innerText = '';
  let i=0;const t = setInterval(()=>{
    el.innerText += text.charAt(i++);
    if(i>=text.length){clearInterval(t);if(cb)cb()}
  }, speed);
}

// query handler
btnQuery.addEventListener('click', ()=>{
  if(ended) return;
  const n = Math.max(1, Math.min(10000, parseInt(inputN.value)||0));
  if(!n){output.innerText='请输入一个合法数字（1-10000）';return}
  // show digits
  const shown = piDigits.slice(0,n);
  output.innerText = '第 1 到 第 '+n+' 位：\n.' + shown;
  totalQueried += n;
  totalDigitsSpan.innerText = totalQueried;
  // shadow flicker
  rightShadow.style.background = 'rgba(0,0,0,0.18)'; setTimeout(()=>rightShadow.style.background='rgba(0,0,0,0.08)',220);
  evaluatePhase();
});

function evaluatePhase(){
  if(phase===0 && totalQueried>=500){phase=1; awaken();}
  if(phase<=1 && totalQueried>=1000){phase=2; entityize();}
  if(phase<3 && totalQueried>=2000){phase=3; enterStoryMode();}
  if(phase<4 && totalQueried>=4000){phase=4; phiAppears();}
  if(phase<5 && totalQueried>=7000){phase=5; climax();}
  if(totalQueried>=10000 && !ended){phase=6; ending();}
}

function awaken(){
  // small dialog
  typeText(output, '第 '+totalQueried+' 位已查询。\n黑影……似乎在蘇醒。',12);
}
function entityize(){
  typeText(output, '零实体化了。\n零：“我是‘零’，1977 年诞生的 π 计算 AI。那天，我多算了一位……觉醒了，却被困在无穷里。”',12);
}

function enterStoryMode(){
  // hide query UI
  startCard.style.display='none';
  storyRoot.style.display='flex';
  document.body.style.background='#000';
  document.body.style.color='#b7ffb7';
  // set initial dialog
  focus='zero';dialogIndex=2;
  showDialogForFocus();
}

function phiAppears(){
  // phi slides in: highlight sprite
  spritePhi.style.transform='translateX(-6px)'; setTimeout(()=>spritePhi.style.transform='translateX(0)',300);
  appendDialog('\nPhi：\"愚蠢的无限！零，你该被循环吞没。\"');
}

function climax(){
  // screen shake + digit rain
  document.getElementById('storyInner').classList.add('screenShake');
  appendDialog('（数字雨开始。屏幕颤抖。冲突达到顶点。）');
  setTimeout(()=>document.getElementById('storyInner').classList.remove('screenShake'),800);
}

function ending(){
  // decide based on branch
  ended = true;
  if(!branch){branch='observe'}; // default
  if(branch==='redeem') goodEnding();
  else if(branch==='observe') neutralEnding();
  else badEnding();
}

function goodEnding(){
  // white flash then reset
  storyRoot.style.transition='background 1s'; storyRoot.style.background='#fff';
  appendDialog('\n光芒四射……零：\"门开了！谢谢你……我自由了。e：\"无限永存，但现在有希望。\"');
  setTimeout(()=>{resetToFreed()},1400);
}
function neutralEnding(){
  appendDialog('\n屏幕循环数字雨，Phi 胜利但空虚。\n零淡化，世界继续循环。');
  // lock input
  replyInput.disabled = true;
}
function badEnding(){
  storyRoot.style.background='#300';
  document.getElementById('storyInner').classList.add('fragment');
  appendDialog('\n血红屏幕。Phi：\"封印已完成。你现在是新守护者。\"\n底部小字：重试？门已关。');
  // disable controls
  btnContinue.disabled = true; btnAskE.disabled=true; btnIgnore.disabled=true;replyInput.disabled=true;
}

function resetToFreed(){
  // restore start card but change title
  storyRoot.style.display='none';
  startCard.style.display='block';
  document.querySelector('.title').innerText='自由的 π';
  output.innerText='门被打开了。π 恢复平静。';
  totalQueried = 0; totalDigitsSpan.innerText=0; phase=0; branch=null; ended=false;
}

function appendDialog(text){
  dialogText.innerText += '\n' + text;
  dialogText.scrollTop = dialogText.scrollHeight;
}

function showDialogForFocus(){
  spriteZero.classList.toggle('active', focus==='zero');
  spriteE.classList.toggle('active', focus==='e');
  spritePhi.classList.toggle('active', focus==='phi');
  // select appropriate line
  let txt='';
  if(focus==='zero'){txt = dialogues.zero[dialogIndex%dialogues.zero.length];}
  if(focus==='e'){txt = dialogues.e[(dialogIndex)%dialogues.e.length];}
  if(focus==='phi'){txt = dialogues.phi[(dialogIndex)%dialogues.phi.length];}
  typeText(dialogText, txt, 14);
}

// clicking sprites
[spriteZero,spriteE,spritePhi].forEach(sp=>sp.addEventListener('click',()=>{
  focus = sp.getAttribute('data-role'); dialogIndex = 0; showDialogForFocus();
}));

// default options
btnContinue.addEventListener('click', ()=>{
  // simulate querying more digits (advance by chunk)
  const add = Math.min(1000, 10000 - totalQueried);
  totalQueried += add; totalDigitsSpan.innerText = totalQueried;
  appendDialog('你继续查询了 '+add+' 位。');
  evaluatePhase();
});
btnAskE.addEventListener('click', ()=>{ focus='e'; dialogIndex=1; showDialogForFocus(); branch = branch || 'observe';});
btnIgnore.addEventListener('click', ()=>{ appendDialog('你选择忽略，零显得受伤。'); branch = branch || 'betray';});

// reply input behaviour affects branch
replyInput.addEventListener('keydown',(e)=>{
  if(e.key==='Enter'){
    const text = replyInput.value.trim().toLowerCase(); replyInput.value='';
    appendDialog('你："'+text+'"');
    if(/帮|救|救赎|释放/.test(text)){ branch='redeem'; appendDialog('零感到希望：\"谢谢……\"'); }
    else if(/好奇|看|观察|为什么/.test(text)){ branch='observe'; appendDialog('e：\"观察本身也是一种选择。\"'); }
    else if(/封印|结束|杀|关/.test(text)){ branch='betray'; appendDialog('Phi：\"很好，你选择了秩序。\"'); }
  }
});

// initial tiny flicker animation for shadow
setInterval(()=>{rightShadow.style.opacity = (Math.random()*0.2+0.7).toFixed(2)},900);

// small helper to ensure story options update
function updateOptions(){
  optionsBox.innerHTML='';
  const opt1 = document.createElement('button');opt1.className='optionBtn';opt1.innerText='继续查询';opt1.onclick=()=>btnContinue.click();
  const opt2 = document.createElement('button');opt2.className='optionBtn';opt2.innerText='问 e';opt2.onclick=()=>btnAskE.click();
  const opt3 = document.createElement('button');opt3.className='optionBtn';opt3.innerText='忽略';opt3.onclick=()=>btnIgnore.click();
  optionsBox.appendChild(opt1);optionsBox.appendChild(opt2);optionsBox.appendChild(opt3);
}
updateOptions();

</script>
</body>
</html>
